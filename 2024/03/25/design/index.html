

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Liu Jinyi">
  <meta name="keywords" content="">
  
    <meta name="description" content="Name Oreo Database Assumptions on the platforms:  The option when reading for single-item strong consistency Atomic conditional update and delete on single items, similar to Test-and-Set. Ability to i">
<meta property="og:type" content="article">
<meta property="og:title" content="Kelicopter&#39;s Blog">
<meta property="og:url" content="http://blog.kkkzoz.top/2024/03/25/design/index.html">
<meta property="og:site_name" content="Kelicopter&#39;s Blog">
<meta property="og:description" content="Name Oreo Database Assumptions on the platforms:  The option when reading for single-item strong consistency Atomic conditional update and delete on single items, similar to Test-and-Set. Ability to i">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-03-25T08:45:07.602Z">
<meta property="article:modified_time" content="2024-03-25T08:45:07.602Z">
<meta property="article:author" content="Liu Jinyi">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Kelicopter&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.kkkzoz.top","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Kelicopter</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text=""></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-03-25 16:45" pubdate>
          March 25, 2024 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          12k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          97 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header"></h1>
            
            
              <div class="markdown-body">
                
                <h2 id="Name">Name</h2>
<p>Oreo</p>
<h2 id="Database">Database</h2>
<p>Assumptions on the platforms:</p>
<ul>
<li>The option when reading for single-item strong consistency</li>
<li>Atomic conditional update and delete on single items, similar to Test-and-Set.</li>
<li>Ability to include user-defined meta-data along with the content of a data item.</li>
</ul>
<h3 id="Redis">Redis</h3>
<h4 id="Conditional-Set">Conditional Set</h4>
<p>Yes, we can use <code>lua-script</code> to do this:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> lts = <span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">&#x27;GET&#x27;</span>, KEYS[<span class="hljs-number">1</span>]))<br><span class="hljs-keyword">local</span> nts = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">1</span>])<br><span class="hljs-keyword">if</span> lts &lt; nts <span class="hljs-keyword">then</span><br>      redis.call(<span class="hljs-string">&#x27;SET&#x27;</span>, KEYS[<span class="hljs-number">1</span>], nts)<br>      redis.call(<span class="hljs-string">&#x27;SET, KEYS[2], ARGV[2])</span><br><span class="hljs-string">end</span><br></code></pre></td></tr></table></figure>
<p>Or</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">EVAL <span class="hljs-string">&quot;if redis.call(&#x27;get&#x27;, &#x27;myKey&#x27;) == &#x27;expectedVal&#x27; then return redis.call(&#x27;set&#x27;, &#x27;myKey&#x27;, &#x27;newVal&#x27;) else return redis.error_reply(&#x27;myKey has changed!&#x27;) end&quot;</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>Redis, unlike MongoDB, does not have a built-in query language or update operators for performing conditional updates directly like you would in a document store or relational database. Instead, updates in Redis are typically done by fetching the data, modifying it in the application, and then writing it back to Redis. For conditional updates, you would implement the condition checks in your application code.</p>
<p>However, if you want to perform atomic updates conditionally, you can use Lua scripting with Redis or the WATCH command for optimistic locking.</p>
<p>Here’s a basic example of how you could perform a conditional set in Redis using Lua scripting with the go-redis library:</p>
<p>Firstly, install the go-redis package if you haven’t:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">go get github. Com/go-redis/redis/v8<br></code></pre></td></tr></table></figure>
<p>Now here’s an example of doing a conditional set in Redis:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;context&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/go-redis/redis/v8&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// Create a new Redis client.</span><br>    rdb := redis.NewClient(&amp;redis.Options&#123;<br>        Addr:     <span class="hljs-string">&quot;localhost:6379&quot;</span>, <span class="hljs-comment">// Your Redis address</span><br>        Password: <span class="hljs-string">&quot;&quot;</span>,               <span class="hljs-comment">// No password set</span><br>        DB:       <span class="hljs-number">0</span>,                <span class="hljs-comment">// Use default DB</span><br>    &#125;)<br><br>    <span class="hljs-comment">// Use context for timeout and cancellation.</span><br>    ctx := context.Background()<br><br>    <span class="hljs-comment">// Define the Lua script for conditional set.</span><br>    <span class="hljs-comment">// Key &#x27;1&#x27; will be checked if its value is &quot;existing_value&quot;.</span><br>    <span class="hljs-comment">// If condition matches, we will set the new value &quot;new_value&quot;.</span><br>    script := <span class="hljs-string">`</span><br><span class="hljs-string">        if redis.call(&quot;GET&quot;, KEYS[1]) == ARGV[1] then</span><br><span class="hljs-string">            return redis.call(&quot;SET&quot;, KEYS[1], ARGV[2])</span><br><span class="hljs-string">        else</span><br><span class="hljs-string">            return 0</span><br><span class="hljs-string">        end</span><br><span class="hljs-string">    `</span><br><br>    <span class="hljs-comment">// Using Eval to run the Lua script.</span><br>    <span class="hljs-comment">// KEYS[1]: The key to be checked and possibly set.</span><br>    <span class="hljs-comment">// ARGV[1]: The existing value we expect.</span><br>    <span class="hljs-comment">// ARGV[2]: The new value to set if the condition matches.</span><br>    result, err := rdb.Eval(ctx, script, []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;your_key&quot;</span>&#125;, <span class="hljs-string">&quot;existing_value&quot;</span>, <span class="hljs-string">&quot;new_value&quot;</span>).Result()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Println(<span class="hljs-string">&quot;Script result:&quot;</span>, result)<br><br>    <span class="hljs-comment">// Close the Redis client when finished.</span><br>    <span class="hljs-keyword">if</span> err := rdb.Close(); err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="Meta-data">Meta-data</h4>
<p>Use <code>HSET</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">redis&gt; HSET myhash field2 <span class="hljs-string">&quot;Hi&quot;</span> field3 <span class="hljs-string">&quot;World&quot;</span><br>(<span class="hljs-built_in">integer</span>) 2<br>redis&gt; HGET myhash field2<br><span class="hljs-string">&quot;Hi&quot;</span><br>redis&gt; HGET myhash field3<br><span class="hljs-string">&quot;World&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="MongoDB">MongoDB</h3>
<h4 id="Conditional-Set-2">Conditional Set</h4>
<p>In Go (Golang), you use the MongoDB Go Driver to interact with MongoDB. To perform a conditional update, you build a filter to match the documents you want to update based on your conditions, and then use the update operators to change the data accordingly.</p>
<p>First, ensure you have the MongoDB Go Driver installed:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">go get go.Mongodb.org/mongo-driver/mongo<br>go get go.Mongodb.org/mongo-driver/mongo/options<br></code></pre></td></tr></table></figure>
<p>Here is an example of how to perform a conditional update using the MongoDB Go Driver in Golang:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;context&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;time&quot;</span><br><br>    <span class="hljs-string">&quot;go.mongodb.org/mongo-driver/bson&quot;</span><br>    <span class="hljs-string">&quot;go.mongodb.org/mongo-driver/mongo&quot;</span><br>    <span class="hljs-string">&quot;go.mongodb.org/mongo-driver/mongo/options&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// Set client options</span><br>    clientOptions := options.Client().ApplyURI(<span class="hljs-string">&quot;your-mongodb-uri&quot;</span>) <span class="hljs-comment">// Replace with your MongoDB URI</span><br><br>    <span class="hljs-comment">// Connect to MongoDB</span><br>    client, err := mongo.Connect(context.TODO(), clientOptions)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    <span class="hljs-comment">// Check the connection</span><br>    err = client.Ping(context.Background(), <span class="hljs-literal">nil</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;Connected to MongoDB!&quot;</span>)<br><br>    <span class="hljs-comment">// Get handle for your collection</span><br>    collection := client.Database(<span class="hljs-string">&quot;your-db-name&quot;</span>).Collection(<span class="hljs-string">&quot;your-collection-name&quot;</span>)<br><br>    <span class="hljs-comment">// Define the filter for documents you want to update</span><br>    filter := bson.M&#123;<span class="hljs-string">&quot;reviewCount&quot;</span>: bson.M&#123;<span class="hljs-string">&quot;$gt&quot;</span>: <span class="hljs-number">10</span>&#125;&#125; <span class="hljs-comment">// Documents with reviewCount &gt; 10</span><br><br>    <span class="hljs-comment">// Define the update operation</span><br>    update := bson.M&#123;<br>        <span class="hljs-string">&quot;$set&quot;</span>: bson.M&#123;<br>            <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;approved&quot;</span>,<br>        &#125;,<br>    &#125;<br><br>    <span class="hljs-comment">// Perform the update operation</span><br>    result, err := collection.UpdateMany(context.Background(), filter, update)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Printf(<span class="hljs-string">&quot;Matched %v documents and updated %v documents.\n&quot;</span>, result.MatchedCount, result.ModifiedCount&#125;<br><br>    <span class="hljs-comment">// Close the connection once no longer needed</span><br>    err = client.Disconnect(context.TODO())<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;Connection to MongoDB closed.&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
<p>In the above example, replace your-mongodb-uri, your-db-name, and your-collection-name with your MongoDB connection string, database name, and collection name, respectively.</p>
<p>The key points in this program are: - Establishing a connection to the MongoDB server using mongo. Connect. - Creating a filter with the condition (bson. M{“reviewCount”: bson. M{“$gt”: 10}}) which matches documents where the field reviewCount is greater than 10. - Defining the update using the $set operator to change the status field to “approved” for documents that match the filter. - Calling collection. UpdateMany with the context, the filter, and the update definition to perform the update operation.</p>
<h4 id="Meta-data-2">Meta-data</h4>
<p>In a MongoDB database, we can store metadata as part of the documents in a collection. Since MongoDB is schema-less, you can structure your documents as you like, including any number of fields that could serve as metadata.</p>
<p>For example:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;_id&quot;</span><span class="hljs-punctuation">:</span> ObjectId(<span class="hljs-string">&quot;507f1f77bcf86cd799439011&quot;</span>)<span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;filename&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;picture.jpg&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fileSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;500KB&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;uploadDate&quot;</span><span class="hljs-punctuation">:</span> ISODate(<span class="hljs-string">&quot;2020-10-01T00:00:00Z&quot;</span>)<span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;format&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jpg&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;uploaderId&quot;</span><span class="hljs-punctuation">:</span> ObjectId(<span class="hljs-string">&quot;507f191e810c19729de860ea&quot;</span>)<span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;nature&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;vacation&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;A photo from my summer vacation.&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="Couchdb">Couchdb</h3>
<h4 id="Conditional-Update">Conditional Update</h4>
<p>To perform a conditional update in CouchDB using Golang, you would typically use the CouchDB REST API with a HTTP library in Golang, such as net/http or higher-level libraries like resty.</p>
<p>The general steps for performing a conditional update (also known as an update with conflict detection) in CouchDB from a Golang application are:</p>
<p>Retrieve the current document along with its _rev (revision) field.<br>
Modify the document in your application code.<br>
Send an HTTP PUT request with the updated document and the _rev field back to CouchDB.</p>
<p>If the _rev field you’re sending back matches the current revision of the document in the database, CouchDB will allow the update. Otherwise, CouchDB will respond with a conflict error, indicating that the document has been updated by another process since you retrieved it.</p>
<p>Here’s an example of how you might do this in Golang:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;bytes&quot;</span><br>    <span class="hljs-string">&quot;encoding/json&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;io/ioutil&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Document <span class="hljs-keyword">struct</span> &#123;<br>    ID    <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;_id&quot;`</span><br>    Rev   <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;_rev,omitempty&quot;`</span><br>    <span class="hljs-comment">// Add other document-specific fields here</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getDocument</span><span class="hljs-params">(url <span class="hljs-type">string</span>)</span></span> (Document, <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-keyword">var</span> doc Document<br>    resp, err := http.Get(url)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> doc, err<br>    &#125;<br>    <span class="hljs-keyword">defer</span> resp.Body.Close()<br>    body, err := ioutil.ReadAll(resp.Body)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> doc, err<br>    &#125;<br>    err = json.Unmarshal(body, &amp;doc)<br>    <span class="hljs-keyword">return</span> doc, err<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateDocument</span><span class="hljs-params">(url <span class="hljs-type">string</span>, doc Document)</span></span> <span class="hljs-type">error</span> &#123;<br>    docBytes, err := json.Marshal(doc)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> err<br>    &#125;<br>    req, err := http.NewRequest(<span class="hljs-string">&quot;PUT&quot;</span>, url, bytes.NewBuffer(docBytes))<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> err<br>    &#125;<br>    req.Header.Set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>)<br><br>    client := &amp;http.Client&#123;&#125;<br>    resp, err := client.Do(req)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> err<br>    &#125;<br>    <span class="hljs-keyword">defer</span> resp.Body.Close()<br><br>    <span class="hljs-comment">// Check if update was successful, if not handle the conflict</span><br>    <span class="hljs-keyword">if</span> resp.StatusCode != http.StatusCreated &#123;<br>        <span class="hljs-comment">// Handle response codes like 409 Conflict here</span><br>        body, _ := ioutil.ReadAll(resp.Body)<br>        fmt.Printf(<span class="hljs-string">&quot;CouchDB Error: %s\n&quot;</span>, body)<br>        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;couchdb error: %s&quot;</span>, resp.Status)<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    couchdbUrl := <span class="hljs-string">&quot;http://localhost:5984/mydb/mydocid&quot;</span><br><br>    <span class="hljs-comment">// Retrieve the document you want to update</span><br>    doc, err := getDocument(couchdbUrl)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-comment">// Handle error</span><br>        fmt.Println(err)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">// Modify the document as needed</span><br>    <span class="hljs-comment">// doc.&lt;field&gt; = &lt;new value&gt;</span><br><br>    <span class="hljs-comment">// Update the document with the new revision</span><br>    err = updateDocument(couchdbUrl, doc)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-comment">// Handle error</span><br>        fmt.Println(err)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>In this code sample:</p>
<p>The getDocument function retrieves a document from CouchDB and returns it along with its current _rev id.<br>
The updateDocument function takes an updated document and sends it back to CouchDB. It looks at the HTTP response to determine if the update was successful or if there was a conflict.<br>
The main function is an example of how to retrieve a document, modify it, and try to update it in CouchDB.</p>
<p>Please note that you will need to modify the Document struct to include the actual fields present in your documents and handle additional error cases or HTTP response statuses as appropriate for your application’s requirements.</p>
<h4 id="Meta-data-3">Meta-data</h4>
<p>CouchDB allows you to add user-defined (custom) metadata fields to any document. Generally, custom metadata fields are just like any other fields in a document, and you can include them as needed. However, you should avoid using field names that begin with an underscore (_) because those are reserved for CouchDB’s own metadata (like _id, _rev, etc.).</p>
<p>Here’s an example of how you might add custom metadata to a CouchDB document using Golang:</p>
<p>Define the document structure, including any custom metadata fields:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> CustomDocument <span class="hljs-keyword">struct</span> &#123;<br>    ID      <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;_id&quot;`</span><br>    Rev     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;_rev,omitempty&quot;`</span><br>    Type    <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;type&quot;`</span><br>    MyMeta  <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-string">`json:&quot;my_meta&quot;`</span><br>    <span class="hljs-comment">// Add other document-specific fields here</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>In this example, the MyMeta map can hold various key-value pairs that will serve as your custom metadata fields.</p>
<p>Insert the document with custom metadata using an HTTP POST request:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createDocumentWithMetadata</span><span class="hljs-params">(url <span class="hljs-type">string</span>, doc CustomDocument)</span></span> <span class="hljs-type">error</span> &#123;<br>    docBytes, err := json.Marshal(doc)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> err<br>    &#125;<br>    resp, err := http.Post(url, <span class="hljs-string">&quot;application/json&quot;</span>, bytes.NewBuffer(docBytes))<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> err<br>    &#125;<br>    <span class="hljs-keyword">defer</span> resp.Body.Close()<br>    <span class="hljs-keyword">if</span> resp.StatusCode != http.StatusCreated &#123;<br>        body, _ := ioutil.ReadAll(resp.Body)<br>        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;failed to create doc: %s, %s&quot;</span>, resp.Status, body)<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    couchdbUrl := <span class="hljs-string">&quot;http://localhost:5984/mydb&quot;</span><br><br>    <span class="hljs-comment">// Create and populate your document</span><br>    doc := CustomDocument&#123;<br>        ID:     <span class="hljs-string">&quot;mydocid&quot;</span>,<br>        Type:   <span class="hljs-string">&quot;example&quot;</span>,<br>        MyMeta: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<br>            <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;John Doe&quot;</span>,<br>            <span class="hljs-string">&quot;tags&quot;</span>:   []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;example&quot;</span>, <span class="hljs-string">&quot;metadata&quot;</span>&#125;,<br>        &#125;,<br>        <span class="hljs-comment">// Populate other document fields as necessary</span><br>    &#125;<br><br>    <span class="hljs-comment">// Save the document with the custom metadata to CouchDB</span><br>    err := createDocumentWithMetadata(couchdbUrl, doc)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;Error creating document:&quot;</span>, err)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;Document created successfully&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>In this code snippet: - CustomDocument has a my_meta field that holds your custom metadata. - createDocumentWithMetadata serializes the document and sends an HTTP POST request to the database URL.</p>
<p>Remember to replace &quot; <a target="_blank" rel="noopener" href="http://localhost:5984/mydb">http://localhost:5984/mydb</a>&quot; with the actual URL of your CouchDB database and update the data structure to reflect the fields that you want to include.</p>
<p>It’s important to design your metadata, keeping in mind that you should not start the keys with an underscore, and all the data included should be intentional and relevant for your application logic or for future queries and indexing.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div></div>
      <div>http://blog.kkkzoz.top/2024/03/25/design/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Liu Jinyi</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>March 25, 2024</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
            </div>

            
  
  
    <article id="comments">
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'KKKZOZ/KKKZOZ.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>







  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
